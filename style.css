// script.js

document.addEventListener("DOMContentLoaded", () => {
    
    // --- 0. NAVBAR SCROLL EFFECT (NEW) ---
    const navbar = document.querySelector('.navbar');
    
    window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });

    // --- 1. INISIALISASI SMOOTH SCROLL (LENIS) ---
    const lenis = new Lenis({
        duration: 1.2,
        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
        direction: 'vertical',
        smooth: true,
    });

    function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
    }
    requestAnimationFrame(raf);

    gsap.registerPlugin(ScrollTrigger);
    
    // --- 2. ANIMASI PARALLAX (Hanya di Homepage) ---
    if(document.querySelector('#hero')) {
        const heroTimeline = gsap.timeline({
            scrollTrigger: {
                trigger: "#hero",
                start: "top top",
                end: "bottom top",
                scrub: true
            }
        });

        heroTimeline.to("#mountains", { yPercent: 30, ease: "none" }, 0);
        heroTimeline.to("#sky", { yPercent: 15, ease: "none" }, 0);
        heroTimeline.to(".hero-content", { yPercent: -50, opacity: 0, ease: "none" }, 0);
        heroTimeline.to("#forest", { scale: 1.1, yPercent: 10, ease: "none" }, 0);
    }

    // --- 3. ANIMASI TEXT REVEAL ---
    const revealElements = document.querySelectorAll(".reveal-type");
    revealElements.forEach(element => {
        gsap.fromTo(element, 
            { y: 30, opacity: 0 },
            {
                y: 0, opacity: 1, duration: 1, ease: "power2.out",
                scrollTrigger: {
                    trigger: element,
                    start: "top 85%",
                    toggleActions: "play none none reverse"
                }
            }
        );
    });

    // --- 4. MAP LEAFLET (Cek keberadaan elemen dulu) ---
    if(document.getElementById('trekking-map')) {
        const defaultLat = -8.4113;
        const defaultLng = 116.4573;
        const map = L.map('trekking-map').setView([defaultLat, defaultLng], 13);
        
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap contributors &copy; CARTO'
        }).addTo(map); // Menggunakan Peta Mode Gelap agar sesuai tema

        L.marker([defaultLat, defaultLng]).addTo(map)
           .bindPopup('<b>Basecamp Rinjani</b><br>Titik awal pendakian.')
           .openPopup();
    }

    // --- 5. WEATHER WIDGET ---
    const searchBtn = document.getElementById('search-btn');
    if(searchBtn) {
        const apiKey = 'YOUR_API_KEY_HERE'; // Masukkan API Key
        const cityInput = document.getElementById('city-input');

        searchBtn.addEventListener('click', () => {
            const city = cityInput.value;
            if(city) fetchWeather(city);
        });

        async function fetchWeather(city) {
            document.querySelector('.loader').classList.remove('hidden');
            document.querySelector('.weather-data').classList.add('hidden');
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=id`);
                if (!response.ok) throw new Error('Kota tidak ditemukan');
                const data = await response.json();
                
                document.getElementById('temp-display').textContent = `${Math.round(data.main.temp)}Â°C`;
                document.getElementById('desc-display').textContent = data.weather.description;
                document.getElementById('humidity').textContent = `${data.main.humidity}%`;
                document.getElementById('wind').textContent = `${data.wind.speed} m/s`;
                
                const iconCode = data.weather.icon;
                document.getElementById('weather-icon').src = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
                document.querySelector('.weather-data').classList.remove('hidden');
            } catch (error) {
                alert(error.message);
            } finally {
                document.querySelector('.loader').classList.add('hidden');
            }
        }
    }
});
